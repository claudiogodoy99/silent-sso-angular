{"ast":null,"code":"/*! @azure/msal-browser v2.32.1 2022-12-07 */\n'use strict';\n\nimport { __extends, __awaiter, __generator, __assign } from '../_virtual/_tslib.js';\nimport { OIDC_DEFAULT_SCOPES, StringUtils, UrlString, Constants, AuthError, ThrottlingUtils, ProtocolUtils, PerformanceEvents } from '@azure/msal-common';\nimport { StandardInteractionClient } from './StandardInteractionClient.js';\nimport { EventType } from '../event/EventType.js';\nimport { BrowserConstants, InteractionType, ApiId } from '../utils/BrowserConstants.js';\nimport { BrowserUtils } from '../utils/BrowserUtils.js';\nimport { NativeInteractionClient } from './NativeInteractionClient.js';\nimport { NativeMessageHandler } from '../broker/nativeBroker/NativeMessageHandler.js';\nimport { BrowserAuthError } from '../error/BrowserAuthError.js';\nimport { InteractionHandler } from '../interaction_handler/InteractionHandler.js';\n/*\r\n * Copyright (c) Microsoft Corporation. All rights reserved.\r\n * Licensed under the MIT License.\r\n */\n\nvar PopupClient =\n/** @class */\nfunction (_super) {\n  __extends(PopupClient, _super);\n\n  function PopupClient(config, storageImpl, browserCrypto, logger, eventHandler, navigationClient, performanceClient, nativeStorageImpl, nativeMessageHandler, correlationId) {\n    var _this = _super.call(this, config, storageImpl, browserCrypto, logger, eventHandler, navigationClient, performanceClient, nativeMessageHandler, correlationId) || this; // Properly sets this reference for the unload event.\n\n\n    _this.unloadWindow = _this.unloadWindow.bind(_this);\n    _this.nativeStorage = nativeStorageImpl;\n    return _this;\n  }\n  /**\r\n   * Acquires tokens by opening a popup window to the /authorize endpoint of the authority\r\n   * @param request\r\n   */\n\n\n  PopupClient.prototype.acquireToken = function (request) {\n    try {\n      var popupName = this.generatePopupName(request.scopes || OIDC_DEFAULT_SCOPES, request.authority || this.config.auth.authority);\n      var popupWindowAttributes = request.popupWindowAttributes || {}; // asyncPopups flag is true. Acquires token without first opening popup. Popup will be opened later asynchronously.\n\n      if (this.config.system.asyncPopups) {\n        this.logger.verbose(\"asyncPopups set to true, acquiring token\"); // Passes on popup position and dimensions if in request\n\n        return this.acquireTokenPopupAsync(request, popupName, popupWindowAttributes);\n      } else {\n        // asyncPopups flag is set to false. Opens popup before acquiring token.\n        this.logger.verbose(\"asyncPopup set to false, opening popup before acquiring token\");\n        var popup = this.openSizedPopup(\"about:blank\", popupName, popupWindowAttributes);\n        return this.acquireTokenPopupAsync(request, popupName, popupWindowAttributes, popup);\n      }\n    } catch (e) {\n      return Promise.reject(e);\n    }\n  };\n  /**\r\n   * Clears local cache for the current user then opens a popup window prompting the user to sign-out of the server\r\n   * @param logoutRequest\r\n   */\n\n\n  PopupClient.prototype.logout = function (logoutRequest) {\n    try {\n      this.logger.verbose(\"logoutPopup called\");\n      var validLogoutRequest = this.initializeLogoutRequest(logoutRequest);\n      var popupName = this.generateLogoutPopupName(validLogoutRequest);\n      var authority = logoutRequest && logoutRequest.authority;\n      var mainWindowRedirectUri = logoutRequest && logoutRequest.mainWindowRedirectUri;\n      var popupWindowAttributes = (logoutRequest === null || logoutRequest === void 0 ? void 0 : logoutRequest.popupWindowAttributes) || {}; // asyncPopups flag is true. Acquires token without first opening popup. Popup will be opened later asynchronously.\n\n      if (this.config.system.asyncPopups) {\n        this.logger.verbose(\"asyncPopups set to true\"); // Passes on popup position and dimensions if in request\n\n        return this.logoutPopupAsync(validLogoutRequest, popupName, popupWindowAttributes, authority, undefined, mainWindowRedirectUri);\n      } else {\n        // asyncPopups flag is set to false. Opens popup before logging out.\n        this.logger.verbose(\"asyncPopup set to false, opening popup\");\n        var popup = this.openSizedPopup(\"about:blank\", popupName, popupWindowAttributes);\n        return this.logoutPopupAsync(validLogoutRequest, popupName, popupWindowAttributes, authority, popup, mainWindowRedirectUri);\n      }\n    } catch (e) {\n      // Since this function is synchronous we need to reject\n      return Promise.reject(e);\n    }\n  };\n  /**\r\n   * Helper which obtains an access_token for your API via opening a popup window in the user's browser\r\n   * @param validRequest\r\n   * @param popupName\r\n   * @param popup\r\n   * @param popupWindowAttributes\r\n   *\r\n   * @returns A promise that is fulfilled when this function has completed, or rejected if an error was raised.\r\n   */\n\n\n  PopupClient.prototype.acquireTokenPopupAsync = function (request, popupName, popupWindowAttributes, popup) {\n    return __awaiter(this, void 0, void 0, function () {\n      var serverTelemetryManager, validRequest, authCodeRequest, authClient, isNativeBroker, fetchNativeAccountIdMeasurement, navigateUrl, interactionHandler, popupParameters, popupWindow, hash, serverParams, state_1, nativeInteractionClient, userRequestState, result, e_1;\n\n      var _this = this;\n\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            this.logger.verbose(\"acquireTokenPopupAsync called\");\n            serverTelemetryManager = this.initializeServerTelemetryManager(ApiId.acquireTokenPopup);\n            return [4\n            /*yield*/\n            , this.initializeAuthorizationRequest(request, InteractionType.Popup)];\n\n          case 1:\n            validRequest = _a.sent();\n            this.browserStorage.updateCacheEntries(validRequest.state, validRequest.nonce, validRequest.authority, validRequest.loginHint || Constants.EMPTY_STRING, validRequest.account || null);\n            _a.label = 2;\n\n          case 2:\n            _a.trys.push([2, 8,, 9]);\n\n            return [4\n            /*yield*/\n            , this.initializeAuthorizationCodeRequest(validRequest)];\n\n          case 3:\n            authCodeRequest = _a.sent();\n            return [4\n            /*yield*/\n            , this.createAuthCodeClient(serverTelemetryManager, validRequest.authority, validRequest.azureCloudOptions)];\n\n          case 4:\n            authClient = _a.sent();\n            this.logger.verbose(\"Auth code client created\");\n            isNativeBroker = NativeMessageHandler.isNativeAvailable(this.config, this.logger, this.nativeMessageHandler, request.authenticationScheme);\n            fetchNativeAccountIdMeasurement = void 0;\n\n            if (isNativeBroker) {\n              fetchNativeAccountIdMeasurement = this.performanceClient.startMeasurement(PerformanceEvents.FetchAccountIdWithNativeBroker, request.correlationId);\n            }\n\n            return [4\n            /*yield*/\n            , authClient.getAuthCodeUrl(__assign(__assign({}, validRequest), {\n              nativeBroker: isNativeBroker\n            }))];\n\n          case 5:\n            navigateUrl = _a.sent();\n            interactionHandler = new InteractionHandler(authClient, this.browserStorage, authCodeRequest, this.logger);\n            popupParameters = {\n              popup: popup,\n              popupName: popupName,\n              popupWindowAttributes: popupWindowAttributes\n            };\n            popupWindow = this.initiateAuthRequest(navigateUrl, popupParameters);\n            this.eventHandler.emitEvent(EventType.POPUP_OPENED, InteractionType.Popup, {\n              popupWindow: popupWindow\n            }, null);\n            return [4\n            /*yield*/\n            , this.monitorPopupForHash(popupWindow)];\n\n          case 6:\n            hash = _a.sent();\n            serverParams = UrlString.getDeserializedHash(hash);\n            state_1 = this.validateAndExtractStateFromHash(serverParams, InteractionType.Popup, validRequest.correlationId); // Remove throttle if it exists\n\n            ThrottlingUtils.removeThrottle(this.browserStorage, this.config.auth.clientId, authCodeRequest);\n\n            if (serverParams.accountId) {\n              this.logger.verbose(\"Account id found in hash, calling WAM for token\"); // end measurement for server call with native brokering enabled\n\n              if (fetchNativeAccountIdMeasurement) {\n                fetchNativeAccountIdMeasurement.endMeasurement({\n                  success: true,\n                  isNativeBroker: true\n                });\n              }\n\n              if (!this.nativeMessageHandler) {\n                throw BrowserAuthError.createNativeConnectionNotEstablishedError();\n              }\n\n              nativeInteractionClient = new NativeInteractionClient(this.config, this.browserStorage, this.browserCrypto, this.logger, this.eventHandler, this.navigationClient, ApiId.acquireTokenPopup, this.performanceClient, this.nativeMessageHandler, serverParams.accountId, this.nativeStorage, validRequest.correlationId);\n              userRequestState = ProtocolUtils.parseRequestState(this.browserCrypto, state_1).userRequestState;\n              return [2\n              /*return*/\n              , nativeInteractionClient.acquireToken(__assign(__assign({}, validRequest), {\n                state: userRequestState,\n                prompt: undefined // Server should handle the prompt, ideally native broker can do this part silently\n\n              })).finally(function () {\n                _this.browserStorage.cleanRequestByState(state_1);\n              })];\n            }\n\n            return [4\n            /*yield*/\n            , interactionHandler.handleCodeResponseFromHash(hash, state_1, authClient.authority, this.networkClient)];\n\n          case 7:\n            result = _a.sent();\n            return [2\n            /*return*/\n            , result];\n\n          case 8:\n            e_1 = _a.sent();\n\n            if (popup) {\n              // Close the synchronous popup if an error is thrown before the window unload event is registered\n              popup.close();\n            }\n\n            if (e_1 instanceof AuthError) {\n              e_1.setCorrelationId(this.correlationId);\n            }\n\n            serverTelemetryManager.cacheFailedRequest(e_1);\n            this.browserStorage.cleanRequestByState(validRequest.state);\n            throw e_1;\n\n          case 9:\n            return [2\n            /*return*/\n            ];\n        }\n      });\n    });\n  };\n  /**\r\n   *\r\n   * @param validRequest\r\n   * @param popupName\r\n   * @param requestAuthority\r\n   * @param popup\r\n   * @param mainWindowRedirectUri\r\n   * @param popupWindowAttributes\r\n   */\n\n\n  PopupClient.prototype.logoutPopupAsync = function (validRequest, popupName, popupWindowAttributes, requestAuthority, popup, mainWindowRedirectUri) {\n    return __awaiter(this, void 0, void 0, function () {\n      var serverTelemetryManager, authClient, logoutUri, popupWindow, navigationOptions, absoluteUrl, e_2;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            this.logger.verbose(\"logoutPopupAsync called\");\n            this.eventHandler.emitEvent(EventType.LOGOUT_START, InteractionType.Popup, validRequest);\n            serverTelemetryManager = this.initializeServerTelemetryManager(ApiId.logoutPopup);\n            _a.label = 1;\n\n          case 1:\n            _a.trys.push([1, 5,, 6]); // Clear cache on logout\n\n\n            return [4\n            /*yield*/\n            , this.clearCacheOnLogout(validRequest.account)];\n\n          case 2:\n            // Clear cache on logout\n            _a.sent();\n\n            return [4\n            /*yield*/\n            , this.createAuthCodeClient(serverTelemetryManager, requestAuthority)];\n\n          case 3:\n            authClient = _a.sent();\n            this.logger.verbose(\"Auth code client created\");\n            logoutUri = authClient.getLogoutUri(validRequest);\n            this.eventHandler.emitEvent(EventType.LOGOUT_SUCCESS, InteractionType.Popup, validRequest);\n            popupWindow = this.openPopup(logoutUri, {\n              popupName: popupName,\n              popupWindowAttributes: popupWindowAttributes,\n              popup: popup\n            });\n            this.eventHandler.emitEvent(EventType.POPUP_OPENED, InteractionType.Popup, {\n              popupWindow: popupWindow\n            }, null);\n            return [4\n            /*yield*/\n            , this.waitForLogoutPopup(popupWindow)];\n\n          case 4:\n            _a.sent();\n\n            if (mainWindowRedirectUri) {\n              navigationOptions = {\n                apiId: ApiId.logoutPopup,\n                timeout: this.config.system.redirectNavigationTimeout,\n                noHistory: false\n              };\n              absoluteUrl = UrlString.getAbsoluteUrl(mainWindowRedirectUri, BrowserUtils.getCurrentUri());\n              this.logger.verbose(\"Redirecting main window to url specified in the request\");\n              this.logger.verbosePii(\"Redirecting main window to: \" + absoluteUrl);\n              this.navigationClient.navigateInternal(absoluteUrl, navigationOptions);\n            } else {\n              this.logger.verbose(\"No main window navigation requested\");\n            }\n\n            return [3\n            /*break*/\n            , 6];\n\n          case 5:\n            e_2 = _a.sent();\n\n            if (popup) {\n              // Close the synchronous popup if an error is thrown before the window unload event is registered\n              popup.close();\n            }\n\n            if (e_2 instanceof AuthError) {\n              e_2.setCorrelationId(this.correlationId);\n            }\n\n            this.browserStorage.setInteractionInProgress(false);\n            this.eventHandler.emitEvent(EventType.LOGOUT_FAILURE, InteractionType.Popup, null, e_2);\n            this.eventHandler.emitEvent(EventType.LOGOUT_END, InteractionType.Popup);\n            serverTelemetryManager.cacheFailedRequest(e_2);\n            throw e_2;\n\n          case 6:\n            this.eventHandler.emitEvent(EventType.LOGOUT_END, InteractionType.Popup);\n            return [2\n            /*return*/\n            ];\n        }\n      });\n    });\n  };\n  /**\r\n   * Opens a popup window with given request Url.\r\n   * @param requestUrl\r\n   */\n\n\n  PopupClient.prototype.initiateAuthRequest = function (requestUrl, params) {\n    // Check that request url is not empty.\n    if (!StringUtils.isEmpty(requestUrl)) {\n      this.logger.infoPii(\"Navigate to: \" + requestUrl); // Open the popup window to requestUrl.\n\n      return this.openPopup(requestUrl, params);\n    } else {\n      // Throw error if request URL is empty.\n      this.logger.error(\"Navigate url is empty\");\n      throw BrowserAuthError.createEmptyNavigationUriError();\n    }\n  };\n  /**\r\n   * Monitors a window until it loads a url with the same origin.\r\n   * @param popupWindow - window that is being monitored\r\n   * @param timeout - timeout for processing hash once popup is redirected back to application\r\n   */\n\n\n  PopupClient.prototype.monitorPopupForHash = function (popupWindow) {\n    var _this = this;\n\n    return new Promise(function (resolve, reject) {\n      /*\r\n       * Polling for popups needs to be tick-based,\r\n       * since a non-trivial amount of time can be spent on interaction (which should not count against the timeout).\r\n       */\n      var maxTicks = _this.config.system.windowHashTimeout / _this.config.system.pollIntervalMilliseconds;\n      var ticks = 0;\n\n      _this.logger.verbose(\"PopupHandler.monitorPopupForHash - polling started\");\n\n      var intervalId = setInterval(function () {\n        // Window is closed\n        if (popupWindow.closed) {\n          _this.logger.error(\"PopupHandler.monitorPopupForHash - window closed\");\n\n          _this.cleanPopup();\n\n          clearInterval(intervalId);\n          reject(BrowserAuthError.createUserCancelledError());\n          return;\n        }\n\n        var href = Constants.EMPTY_STRING;\n        var hash = Constants.EMPTY_STRING;\n\n        try {\n          /*\r\n           * Will throw if cross origin,\r\n           * which should be caught and ignored\r\n           * since we need the interval to keep running while on STS UI.\r\n           */\n          href = popupWindow.location.href;\n          hash = popupWindow.location.hash;\n        } catch (e) {} // Don't process blank pages or cross domain\n\n\n        if (StringUtils.isEmpty(href) || href === \"about:blank\") {\n          return;\n        }\n\n        _this.logger.verbose(\"PopupHandler.monitorPopupForHash - popup window is on same origin as caller\");\n        /*\r\n         * Only run clock when we are on same domain for popups\r\n         * as popup operations can take a long time.\r\n         */\n\n\n        ticks++;\n\n        if (hash) {\n          _this.logger.verbose(\"PopupHandler.monitorPopupForHash - found hash in url\");\n\n          clearInterval(intervalId);\n\n          _this.cleanPopup(popupWindow);\n\n          if (UrlString.hashContainsKnownProperties(hash)) {\n            _this.logger.verbose(\"PopupHandler.monitorPopupForHash - hash contains known properties, returning.\");\n\n            resolve(hash);\n          } else {\n            _this.logger.error(\"PopupHandler.monitorPopupForHash - found hash in url but it does not contain known properties. Check that your router is not changing the hash prematurely.\");\n\n            _this.logger.errorPii(\"PopupHandler.monitorPopupForHash - hash found: \" + hash);\n\n            reject(BrowserAuthError.createHashDoesNotContainKnownPropertiesError());\n          }\n        } else if (ticks > maxTicks) {\n          _this.logger.error(\"PopupHandler.monitorPopupForHash - unable to find hash in url, timing out\");\n\n          clearInterval(intervalId);\n          reject(BrowserAuthError.createMonitorPopupTimeoutError());\n        }\n      }, _this.config.system.pollIntervalMilliseconds);\n    });\n  };\n  /**\r\n   * Waits for user interaction in logout popup window\r\n   * @param popupWindow\r\n   * @returns\r\n   */\n\n\n  PopupClient.prototype.waitForLogoutPopup = function (popupWindow) {\n    var _this = this;\n\n    return new Promise(function (resolve) {\n      _this.logger.verbose(\"PopupHandler.waitForLogoutPopup - polling started\");\n\n      var intervalId = setInterval(function () {\n        // Window is closed\n        if (popupWindow.closed) {\n          _this.logger.error(\"PopupHandler.waitForLogoutPopup - window closed\");\n\n          _this.cleanPopup();\n\n          clearInterval(intervalId);\n          resolve();\n        }\n\n        var href = Constants.EMPTY_STRING;\n\n        try {\n          /*\r\n           * Will throw if cross origin,\r\n           * which should be caught and ignored\r\n           * since we need the interval to keep running while on STS UI.\r\n           */\n          href = popupWindow.location.href;\n        } catch (e) {} // Don't process blank pages or cross domain\n\n\n        if (StringUtils.isEmpty(href) || href === \"about:blank\") {\n          return;\n        }\n\n        _this.logger.verbose(\"PopupHandler.waitForLogoutPopup - popup window is on same origin as caller, closing.\");\n\n        clearInterval(intervalId);\n\n        _this.cleanPopup(popupWindow);\n\n        resolve();\n      }, _this.config.system.pollIntervalMilliseconds);\n    });\n  };\n  /**\r\n   * @hidden\r\n   *\r\n   * Configures popup window for login.\r\n   *\r\n   * @param urlNavigate\r\n   * @param title\r\n   * @param popUpWidth\r\n   * @param popUpHeight\r\n   * @param popupWindowAttributes\r\n   * @ignore\r\n   * @hidden\r\n   */\n\n\n  PopupClient.prototype.openPopup = function (urlNavigate, popupParams) {\n    try {\n      var popupWindow = void 0; // Popup window passed in, setting url to navigate to\n\n      if (popupParams.popup) {\n        popupWindow = popupParams.popup;\n        this.logger.verbosePii(\"Navigating popup window to: \" + urlNavigate);\n        popupWindow.location.assign(urlNavigate);\n      } else if (typeof popupParams.popup === \"undefined\") {\n        // Popup will be undefined if it was not passed in\n        this.logger.verbosePii(\"Opening popup window to: \" + urlNavigate);\n        popupWindow = this.openSizedPopup(urlNavigate, popupParams.popupName, popupParams.popupWindowAttributes);\n      } // Popup will be null if popups are blocked\n\n\n      if (!popupWindow) {\n        throw BrowserAuthError.createEmptyWindowCreatedError();\n      }\n\n      if (popupWindow.focus) {\n        popupWindow.focus();\n      }\n\n      this.currentWindow = popupWindow;\n      window.addEventListener(\"beforeunload\", this.unloadWindow);\n      return popupWindow;\n    } catch (e) {\n      this.logger.error(\"error opening popup \" + e.message);\n      this.browserStorage.setInteractionInProgress(false);\n      throw BrowserAuthError.createPopupWindowError(e.toString());\n    }\n  };\n  /**\r\n   * Helper function to set popup window dimensions and position\r\n   * @param urlNavigate\r\n   * @param popupName\r\n   * @param popupWindowAttributes\r\n   * @returns\r\n   */\n\n\n  PopupClient.prototype.openSizedPopup = function (urlNavigate, popupName, popupWindowAttributes) {\n    var _a, _b, _c, _d;\n    /**\r\n     * adding winLeft and winTop to account for dual monitor\r\n     * using screenLeft and screenTop for IE8 and earlier\r\n     */\n\n\n    var winLeft = window.screenLeft ? window.screenLeft : window.screenX;\n    var winTop = window.screenTop ? window.screenTop : window.screenY;\n    /**\r\n     * window.innerWidth displays browser window\"s height and width excluding toolbars\r\n     * using document.documentElement.clientWidth for IE8 and earlier\r\n     */\n\n    var winWidth = window.innerWidth || document.documentElement.clientWidth || document.body.clientWidth;\n    var winHeight = window.innerHeight || document.documentElement.clientHeight || document.body.clientHeight;\n    var width = (_a = popupWindowAttributes.popupSize) === null || _a === void 0 ? void 0 : _a.width;\n    var height = (_b = popupWindowAttributes.popupSize) === null || _b === void 0 ? void 0 : _b.height;\n    var top = (_c = popupWindowAttributes.popupPosition) === null || _c === void 0 ? void 0 : _c.top;\n    var left = (_d = popupWindowAttributes.popupPosition) === null || _d === void 0 ? void 0 : _d.left;\n\n    if (!width || width < 0 || width > winWidth) {\n      this.logger.verbose(\"Default popup window width used. Window width not configured or invalid.\");\n      width = BrowserConstants.POPUP_WIDTH;\n    }\n\n    if (!height || height < 0 || height > winHeight) {\n      this.logger.verbose(\"Default popup window height used. Window height not configured or invalid.\");\n      height = BrowserConstants.POPUP_HEIGHT;\n    }\n\n    if (!top || top < 0 || top > winHeight) {\n      this.logger.verbose(\"Default popup window top position used. Window top not configured or invalid.\");\n      top = Math.max(0, winHeight / 2 - BrowserConstants.POPUP_HEIGHT / 2 + winTop);\n    }\n\n    if (!left || left < 0 || left > winWidth) {\n      this.logger.verbose(\"Default popup window left position used. Window left not configured or invalid.\");\n      left = Math.max(0, winWidth / 2 - BrowserConstants.POPUP_WIDTH / 2 + winLeft);\n    }\n\n    return window.open(urlNavigate, popupName, \"width=\" + width + \", height=\" + height + \", top=\" + top + \", left=\" + left + \", scrollbars=yes\");\n  };\n  /**\r\n   * Event callback to unload main window.\r\n   */\n\n\n  PopupClient.prototype.unloadWindow = function (e) {\n    this.browserStorage.cleanRequestByInteractionType(InteractionType.Popup);\n\n    if (this.currentWindow) {\n      this.currentWindow.close();\n    } // Guarantees browser unload will happen, so no other errors will be thrown.\n\n\n    e.preventDefault();\n  };\n  /**\r\n   * Closes popup, removes any state vars created during popup calls.\r\n   * @param popupWindow\r\n   */\n\n\n  PopupClient.prototype.cleanPopup = function (popupWindow) {\n    if (popupWindow) {\n      // Close window.\n      popupWindow.close();\n    } // Remove window unload function\n\n\n    window.removeEventListener(\"beforeunload\", this.unloadWindow); // Interaction is completed - remove interaction status.\n\n    this.browserStorage.setInteractionInProgress(false);\n  };\n  /**\r\n   * Generates the name for the popup based on the client id and request\r\n   * @param clientId\r\n   * @param request\r\n   */\n\n\n  PopupClient.prototype.generatePopupName = function (scopes, authority) {\n    return BrowserConstants.POPUP_NAME_PREFIX + \".\" + this.config.auth.clientId + \".\" + scopes.join(\"-\") + \".\" + authority + \".\" + this.correlationId;\n  };\n  /**\r\n   * Generates the name for the popup based on the client id and request for logouts\r\n   * @param clientId\r\n   * @param request\r\n   */\n\n\n  PopupClient.prototype.generateLogoutPopupName = function (request) {\n    var homeAccountId = request.account && request.account.homeAccountId;\n    return BrowserConstants.POPUP_NAME_PREFIX + \".\" + this.config.auth.clientId + \".\" + homeAccountId + \".\" + this.correlationId;\n  };\n\n  return PopupClient;\n}(StandardInteractionClient);\n\nexport { PopupClient };","map":{"version":3,"sources":["C:/Users/claudiogodoy/poc-itau-microfrontend/auth/node_modules/@azure/msal-browser/dist/interaction_client/PopupClient.js"],"names":["__extends","__awaiter","__generator","__assign","OIDC_DEFAULT_SCOPES","StringUtils","UrlString","Constants","AuthError","ThrottlingUtils","ProtocolUtils","PerformanceEvents","StandardInteractionClient","EventType","BrowserConstants","InteractionType","ApiId","BrowserUtils","NativeInteractionClient","NativeMessageHandler","BrowserAuthError","InteractionHandler","PopupClient","_super","config","storageImpl","browserCrypto","logger","eventHandler","navigationClient","performanceClient","nativeStorageImpl","nativeMessageHandler","correlationId","_this","call","unloadWindow","bind","nativeStorage","prototype","acquireToken","request","popupName","generatePopupName","scopes","authority","auth","popupWindowAttributes","system","asyncPopups","verbose","acquireTokenPopupAsync","popup","openSizedPopup","e","Promise","reject","logout","logoutRequest","validLogoutRequest","initializeLogoutRequest","generateLogoutPopupName","mainWindowRedirectUri","logoutPopupAsync","undefined","serverTelemetryManager","validRequest","authCodeRequest","authClient","isNativeBroker","fetchNativeAccountIdMeasurement","navigateUrl","interactionHandler","popupParameters","popupWindow","hash","serverParams","state_1","nativeInteractionClient","userRequestState","result","e_1","_a","label","initializeServerTelemetryManager","acquireTokenPopup","initializeAuthorizationRequest","Popup","sent","browserStorage","updateCacheEntries","state","nonce","loginHint","EMPTY_STRING","account","trys","push","initializeAuthorizationCodeRequest","createAuthCodeClient","azureCloudOptions","isNativeAvailable","authenticationScheme","startMeasurement","FetchAccountIdWithNativeBroker","getAuthCodeUrl","nativeBroker","initiateAuthRequest","emitEvent","POPUP_OPENED","monitorPopupForHash","getDeserializedHash","validateAndExtractStateFromHash","removeThrottle","clientId","accountId","endMeasurement","success","createNativeConnectionNotEstablishedError","parseRequestState","prompt","finally","cleanRequestByState","handleCodeResponseFromHash","networkClient","close","setCorrelationId","cacheFailedRequest","requestAuthority","logoutUri","navigationOptions","absoluteUrl","e_2","LOGOUT_START","logoutPopup","clearCacheOnLogout","getLogoutUri","LOGOUT_SUCCESS","openPopup","waitForLogoutPopup","apiId","timeout","redirectNavigationTimeout","noHistory","getAbsoluteUrl","getCurrentUri","verbosePii","navigateInternal","setInteractionInProgress","LOGOUT_FAILURE","LOGOUT_END","requestUrl","params","isEmpty","infoPii","error","createEmptyNavigationUriError","resolve","maxTicks","windowHashTimeout","pollIntervalMilliseconds","ticks","intervalId","setInterval","closed","cleanPopup","clearInterval","createUserCancelledError","href","location","hashContainsKnownProperties","errorPii","createHashDoesNotContainKnownPropertiesError","createMonitorPopupTimeoutError","urlNavigate","popupParams","assign","createEmptyWindowCreatedError","focus","currentWindow","window","addEventListener","message","createPopupWindowError","toString","_b","_c","_d","winLeft","screenLeft","screenX","winTop","screenTop","screenY","winWidth","innerWidth","document","documentElement","clientWidth","body","winHeight","innerHeight","clientHeight","width","popupSize","height","top","popupPosition","left","POPUP_WIDTH","POPUP_HEIGHT","Math","max","open","cleanRequestByInteractionType","preventDefault","removeEventListener","POPUP_NAME_PREFIX","join","homeAccountId"],"mappings":"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","sourcesContent":["/*! @azure/msal-browser v2.32.1 2022-12-07 */\n'use strict';\nimport { __extends, __awaiter, __generator, __assign } from '../_virtual/_tslib.js';\nimport { OIDC_DEFAULT_SCOPES, StringUtils, UrlString, Constants, AuthError, ThrottlingUtils, ProtocolUtils, PerformanceEvents } from '@azure/msal-common';\nimport { StandardInteractionClient } from './StandardInteractionClient.js';\nimport { EventType } from '../event/EventType.js';\nimport { BrowserConstants, InteractionType, ApiId } from '../utils/BrowserConstants.js';\nimport { BrowserUtils } from '../utils/BrowserUtils.js';\nimport { NativeInteractionClient } from './NativeInteractionClient.js';\nimport { NativeMessageHandler } from '../broker/nativeBroker/NativeMessageHandler.js';\nimport { BrowserAuthError } from '../error/BrowserAuthError.js';\nimport { InteractionHandler } from '../interaction_handler/InteractionHandler.js';\n\n/*\r\n * Copyright (c) Microsoft Corporation. All rights reserved.\r\n * Licensed under the MIT License.\r\n */\r\nvar PopupClient = /** @class */ (function (_super) {\r\n    __extends(PopupClient, _super);\r\n    function PopupClient(config, storageImpl, browserCrypto, logger, eventHandler, navigationClient, performanceClient, nativeStorageImpl, nativeMessageHandler, correlationId) {\r\n        var _this = _super.call(this, config, storageImpl, browserCrypto, logger, eventHandler, navigationClient, performanceClient, nativeMessageHandler, correlationId) || this;\r\n        // Properly sets this reference for the unload event.\r\n        _this.unloadWindow = _this.unloadWindow.bind(_this);\r\n        _this.nativeStorage = nativeStorageImpl;\r\n        return _this;\r\n    }\r\n    /**\r\n     * Acquires tokens by opening a popup window to the /authorize endpoint of the authority\r\n     * @param request\r\n     */\r\n    PopupClient.prototype.acquireToken = function (request) {\r\n        try {\r\n            var popupName = this.generatePopupName(request.scopes || OIDC_DEFAULT_SCOPES, request.authority || this.config.auth.authority);\r\n            var popupWindowAttributes = request.popupWindowAttributes || {};\r\n            // asyncPopups flag is true. Acquires token without first opening popup. Popup will be opened later asynchronously.\r\n            if (this.config.system.asyncPopups) {\r\n                this.logger.verbose(\"asyncPopups set to true, acquiring token\");\r\n                // Passes on popup position and dimensions if in request\r\n                return this.acquireTokenPopupAsync(request, popupName, popupWindowAttributes);\r\n            }\r\n            else {\r\n                // asyncPopups flag is set to false. Opens popup before acquiring token.\r\n                this.logger.verbose(\"asyncPopup set to false, opening popup before acquiring token\");\r\n                var popup = this.openSizedPopup(\"about:blank\", popupName, popupWindowAttributes);\r\n                return this.acquireTokenPopupAsync(request, popupName, popupWindowAttributes, popup);\r\n            }\r\n        }\r\n        catch (e) {\r\n            return Promise.reject(e);\r\n        }\r\n    };\r\n    /**\r\n     * Clears local cache for the current user then opens a popup window prompting the user to sign-out of the server\r\n     * @param logoutRequest\r\n     */\r\n    PopupClient.prototype.logout = function (logoutRequest) {\r\n        try {\r\n            this.logger.verbose(\"logoutPopup called\");\r\n            var validLogoutRequest = this.initializeLogoutRequest(logoutRequest);\r\n            var popupName = this.generateLogoutPopupName(validLogoutRequest);\r\n            var authority = logoutRequest && logoutRequest.authority;\r\n            var mainWindowRedirectUri = logoutRequest && logoutRequest.mainWindowRedirectUri;\r\n            var popupWindowAttributes = (logoutRequest === null || logoutRequest === void 0 ? void 0 : logoutRequest.popupWindowAttributes) || {};\r\n            // asyncPopups flag is true. Acquires token without first opening popup. Popup will be opened later asynchronously.\r\n            if (this.config.system.asyncPopups) {\r\n                this.logger.verbose(\"asyncPopups set to true\");\r\n                // Passes on popup position and dimensions if in request\r\n                return this.logoutPopupAsync(validLogoutRequest, popupName, popupWindowAttributes, authority, undefined, mainWindowRedirectUri);\r\n            }\r\n            else {\r\n                // asyncPopups flag is set to false. Opens popup before logging out.\r\n                this.logger.verbose(\"asyncPopup set to false, opening popup\");\r\n                var popup = this.openSizedPopup(\"about:blank\", popupName, popupWindowAttributes);\r\n                return this.logoutPopupAsync(validLogoutRequest, popupName, popupWindowAttributes, authority, popup, mainWindowRedirectUri);\r\n            }\r\n        }\r\n        catch (e) {\r\n            // Since this function is synchronous we need to reject\r\n            return Promise.reject(e);\r\n        }\r\n    };\r\n    /**\r\n     * Helper which obtains an access_token for your API via opening a popup window in the user's browser\r\n     * @param validRequest\r\n     * @param popupName\r\n     * @param popup\r\n     * @param popupWindowAttributes\r\n     *\r\n     * @returns A promise that is fulfilled when this function has completed, or rejected if an error was raised.\r\n     */\r\n    PopupClient.prototype.acquireTokenPopupAsync = function (request, popupName, popupWindowAttributes, popup) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var serverTelemetryManager, validRequest, authCodeRequest, authClient, isNativeBroker, fetchNativeAccountIdMeasurement, navigateUrl, interactionHandler, popupParameters, popupWindow, hash, serverParams, state_1, nativeInteractionClient, userRequestState, result, e_1;\r\n            var _this = this;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        this.logger.verbose(\"acquireTokenPopupAsync called\");\r\n                        serverTelemetryManager = this.initializeServerTelemetryManager(ApiId.acquireTokenPopup);\r\n                        return [4 /*yield*/, this.initializeAuthorizationRequest(request, InteractionType.Popup)];\r\n                    case 1:\r\n                        validRequest = _a.sent();\r\n                        this.browserStorage.updateCacheEntries(validRequest.state, validRequest.nonce, validRequest.authority, validRequest.loginHint || Constants.EMPTY_STRING, validRequest.account || null);\r\n                        _a.label = 2;\r\n                    case 2:\r\n                        _a.trys.push([2, 8, , 9]);\r\n                        return [4 /*yield*/, this.initializeAuthorizationCodeRequest(validRequest)];\r\n                    case 3:\r\n                        authCodeRequest = _a.sent();\r\n                        return [4 /*yield*/, this.createAuthCodeClient(serverTelemetryManager, validRequest.authority, validRequest.azureCloudOptions)];\r\n                    case 4:\r\n                        authClient = _a.sent();\r\n                        this.logger.verbose(\"Auth code client created\");\r\n                        isNativeBroker = NativeMessageHandler.isNativeAvailable(this.config, this.logger, this.nativeMessageHandler, request.authenticationScheme);\r\n                        fetchNativeAccountIdMeasurement = void 0;\r\n                        if (isNativeBroker) {\r\n                            fetchNativeAccountIdMeasurement = this.performanceClient.startMeasurement(PerformanceEvents.FetchAccountIdWithNativeBroker, request.correlationId);\r\n                        }\r\n                        return [4 /*yield*/, authClient.getAuthCodeUrl(__assign(__assign({}, validRequest), { nativeBroker: isNativeBroker }))];\r\n                    case 5:\r\n                        navigateUrl = _a.sent();\r\n                        interactionHandler = new InteractionHandler(authClient, this.browserStorage, authCodeRequest, this.logger);\r\n                        popupParameters = {\r\n                            popup: popup,\r\n                            popupName: popupName,\r\n                            popupWindowAttributes: popupWindowAttributes\r\n                        };\r\n                        popupWindow = this.initiateAuthRequest(navigateUrl, popupParameters);\r\n                        this.eventHandler.emitEvent(EventType.POPUP_OPENED, InteractionType.Popup, { popupWindow: popupWindow }, null);\r\n                        return [4 /*yield*/, this.monitorPopupForHash(popupWindow)];\r\n                    case 6:\r\n                        hash = _a.sent();\r\n                        serverParams = UrlString.getDeserializedHash(hash);\r\n                        state_1 = this.validateAndExtractStateFromHash(serverParams, InteractionType.Popup, validRequest.correlationId);\r\n                        // Remove throttle if it exists\r\n                        ThrottlingUtils.removeThrottle(this.browserStorage, this.config.auth.clientId, authCodeRequest);\r\n                        if (serverParams.accountId) {\r\n                            this.logger.verbose(\"Account id found in hash, calling WAM for token\");\r\n                            // end measurement for server call with native brokering enabled\r\n                            if (fetchNativeAccountIdMeasurement) {\r\n                                fetchNativeAccountIdMeasurement.endMeasurement({\r\n                                    success: true,\r\n                                    isNativeBroker: true\r\n                                });\r\n                            }\r\n                            if (!this.nativeMessageHandler) {\r\n                                throw BrowserAuthError.createNativeConnectionNotEstablishedError();\r\n                            }\r\n                            nativeInteractionClient = new NativeInteractionClient(this.config, this.browserStorage, this.browserCrypto, this.logger, this.eventHandler, this.navigationClient, ApiId.acquireTokenPopup, this.performanceClient, this.nativeMessageHandler, serverParams.accountId, this.nativeStorage, validRequest.correlationId);\r\n                            userRequestState = ProtocolUtils.parseRequestState(this.browserCrypto, state_1).userRequestState;\r\n                            return [2 /*return*/, nativeInteractionClient.acquireToken(__assign(__assign({}, validRequest), { state: userRequestState, prompt: undefined // Server should handle the prompt, ideally native broker can do this part silently\r\n                                 })).finally(function () {\r\n                                    _this.browserStorage.cleanRequestByState(state_1);\r\n                                })];\r\n                        }\r\n                        return [4 /*yield*/, interactionHandler.handleCodeResponseFromHash(hash, state_1, authClient.authority, this.networkClient)];\r\n                    case 7:\r\n                        result = _a.sent();\r\n                        return [2 /*return*/, result];\r\n                    case 8:\r\n                        e_1 = _a.sent();\r\n                        if (popup) {\r\n                            // Close the synchronous popup if an error is thrown before the window unload event is registered\r\n                            popup.close();\r\n                        }\r\n                        if (e_1 instanceof AuthError) {\r\n                            e_1.setCorrelationId(this.correlationId);\r\n                        }\r\n                        serverTelemetryManager.cacheFailedRequest(e_1);\r\n                        this.browserStorage.cleanRequestByState(validRequest.state);\r\n                        throw e_1;\r\n                    case 9: return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    /**\r\n     *\r\n     * @param validRequest\r\n     * @param popupName\r\n     * @param requestAuthority\r\n     * @param popup\r\n     * @param mainWindowRedirectUri\r\n     * @param popupWindowAttributes\r\n     */\r\n    PopupClient.prototype.logoutPopupAsync = function (validRequest, popupName, popupWindowAttributes, requestAuthority, popup, mainWindowRedirectUri) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var serverTelemetryManager, authClient, logoutUri, popupWindow, navigationOptions, absoluteUrl, e_2;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        this.logger.verbose(\"logoutPopupAsync called\");\r\n                        this.eventHandler.emitEvent(EventType.LOGOUT_START, InteractionType.Popup, validRequest);\r\n                        serverTelemetryManager = this.initializeServerTelemetryManager(ApiId.logoutPopup);\r\n                        _a.label = 1;\r\n                    case 1:\r\n                        _a.trys.push([1, 5, , 6]);\r\n                        // Clear cache on logout\r\n                        return [4 /*yield*/, this.clearCacheOnLogout(validRequest.account)];\r\n                    case 2:\r\n                        // Clear cache on logout\r\n                        _a.sent();\r\n                        return [4 /*yield*/, this.createAuthCodeClient(serverTelemetryManager, requestAuthority)];\r\n                    case 3:\r\n                        authClient = _a.sent();\r\n                        this.logger.verbose(\"Auth code client created\");\r\n                        logoutUri = authClient.getLogoutUri(validRequest);\r\n                        this.eventHandler.emitEvent(EventType.LOGOUT_SUCCESS, InteractionType.Popup, validRequest);\r\n                        popupWindow = this.openPopup(logoutUri, { popupName: popupName, popupWindowAttributes: popupWindowAttributes, popup: popup });\r\n                        this.eventHandler.emitEvent(EventType.POPUP_OPENED, InteractionType.Popup, { popupWindow: popupWindow }, null);\r\n                        return [4 /*yield*/, this.waitForLogoutPopup(popupWindow)];\r\n                    case 4:\r\n                        _a.sent();\r\n                        if (mainWindowRedirectUri) {\r\n                            navigationOptions = {\r\n                                apiId: ApiId.logoutPopup,\r\n                                timeout: this.config.system.redirectNavigationTimeout,\r\n                                noHistory: false\r\n                            };\r\n                            absoluteUrl = UrlString.getAbsoluteUrl(mainWindowRedirectUri, BrowserUtils.getCurrentUri());\r\n                            this.logger.verbose(\"Redirecting main window to url specified in the request\");\r\n                            this.logger.verbosePii(\"Redirecting main window to: \" + absoluteUrl);\r\n                            this.navigationClient.navigateInternal(absoluteUrl, navigationOptions);\r\n                        }\r\n                        else {\r\n                            this.logger.verbose(\"No main window navigation requested\");\r\n                        }\r\n                        return [3 /*break*/, 6];\r\n                    case 5:\r\n                        e_2 = _a.sent();\r\n                        if (popup) {\r\n                            // Close the synchronous popup if an error is thrown before the window unload event is registered\r\n                            popup.close();\r\n                        }\r\n                        if (e_2 instanceof AuthError) {\r\n                            e_2.setCorrelationId(this.correlationId);\r\n                        }\r\n                        this.browserStorage.setInteractionInProgress(false);\r\n                        this.eventHandler.emitEvent(EventType.LOGOUT_FAILURE, InteractionType.Popup, null, e_2);\r\n                        this.eventHandler.emitEvent(EventType.LOGOUT_END, InteractionType.Popup);\r\n                        serverTelemetryManager.cacheFailedRequest(e_2);\r\n                        throw e_2;\r\n                    case 6:\r\n                        this.eventHandler.emitEvent(EventType.LOGOUT_END, InteractionType.Popup);\r\n                        return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    /**\r\n     * Opens a popup window with given request Url.\r\n     * @param requestUrl\r\n     */\r\n    PopupClient.prototype.initiateAuthRequest = function (requestUrl, params) {\r\n        // Check that request url is not empty.\r\n        if (!StringUtils.isEmpty(requestUrl)) {\r\n            this.logger.infoPii(\"Navigate to: \" + requestUrl);\r\n            // Open the popup window to requestUrl.\r\n            return this.openPopup(requestUrl, params);\r\n        }\r\n        else {\r\n            // Throw error if request URL is empty.\r\n            this.logger.error(\"Navigate url is empty\");\r\n            throw BrowserAuthError.createEmptyNavigationUriError();\r\n        }\r\n    };\r\n    /**\r\n     * Monitors a window until it loads a url with the same origin.\r\n     * @param popupWindow - window that is being monitored\r\n     * @param timeout - timeout for processing hash once popup is redirected back to application\r\n     */\r\n    PopupClient.prototype.monitorPopupForHash = function (popupWindow) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            /*\r\n             * Polling for popups needs to be tick-based,\r\n             * since a non-trivial amount of time can be spent on interaction (which should not count against the timeout).\r\n             */\r\n            var maxTicks = _this.config.system.windowHashTimeout / _this.config.system.pollIntervalMilliseconds;\r\n            var ticks = 0;\r\n            _this.logger.verbose(\"PopupHandler.monitorPopupForHash - polling started\");\r\n            var intervalId = setInterval(function () {\r\n                // Window is closed\r\n                if (popupWindow.closed) {\r\n                    _this.logger.error(\"PopupHandler.monitorPopupForHash - window closed\");\r\n                    _this.cleanPopup();\r\n                    clearInterval(intervalId);\r\n                    reject(BrowserAuthError.createUserCancelledError());\r\n                    return;\r\n                }\r\n                var href = Constants.EMPTY_STRING;\r\n                var hash = Constants.EMPTY_STRING;\r\n                try {\r\n                    /*\r\n                     * Will throw if cross origin,\r\n                     * which should be caught and ignored\r\n                     * since we need the interval to keep running while on STS UI.\r\n                     */\r\n                    href = popupWindow.location.href;\r\n                    hash = popupWindow.location.hash;\r\n                }\r\n                catch (e) { }\r\n                // Don't process blank pages or cross domain\r\n                if (StringUtils.isEmpty(href) || href === \"about:blank\") {\r\n                    return;\r\n                }\r\n                _this.logger.verbose(\"PopupHandler.monitorPopupForHash - popup window is on same origin as caller\");\r\n                /*\r\n                 * Only run clock when we are on same domain for popups\r\n                 * as popup operations can take a long time.\r\n                 */\r\n                ticks++;\r\n                if (hash) {\r\n                    _this.logger.verbose(\"PopupHandler.monitorPopupForHash - found hash in url\");\r\n                    clearInterval(intervalId);\r\n                    _this.cleanPopup(popupWindow);\r\n                    if (UrlString.hashContainsKnownProperties(hash)) {\r\n                        _this.logger.verbose(\"PopupHandler.monitorPopupForHash - hash contains known properties, returning.\");\r\n                        resolve(hash);\r\n                    }\r\n                    else {\r\n                        _this.logger.error(\"PopupHandler.monitorPopupForHash - found hash in url but it does not contain known properties. Check that your router is not changing the hash prematurely.\");\r\n                        _this.logger.errorPii(\"PopupHandler.monitorPopupForHash - hash found: \" + hash);\r\n                        reject(BrowserAuthError.createHashDoesNotContainKnownPropertiesError());\r\n                    }\r\n                }\r\n                else if (ticks > maxTicks) {\r\n                    _this.logger.error(\"PopupHandler.monitorPopupForHash - unable to find hash in url, timing out\");\r\n                    clearInterval(intervalId);\r\n                    reject(BrowserAuthError.createMonitorPopupTimeoutError());\r\n                }\r\n            }, _this.config.system.pollIntervalMilliseconds);\r\n        });\r\n    };\r\n    /**\r\n     * Waits for user interaction in logout popup window\r\n     * @param popupWindow\r\n     * @returns\r\n     */\r\n    PopupClient.prototype.waitForLogoutPopup = function (popupWindow) {\r\n        var _this = this;\r\n        return new Promise(function (resolve) {\r\n            _this.logger.verbose(\"PopupHandler.waitForLogoutPopup - polling started\");\r\n            var intervalId = setInterval(function () {\r\n                // Window is closed\r\n                if (popupWindow.closed) {\r\n                    _this.logger.error(\"PopupHandler.waitForLogoutPopup - window closed\");\r\n                    _this.cleanPopup();\r\n                    clearInterval(intervalId);\r\n                    resolve();\r\n                }\r\n                var href = Constants.EMPTY_STRING;\r\n                try {\r\n                    /*\r\n                     * Will throw if cross origin,\r\n                     * which should be caught and ignored\r\n                     * since we need the interval to keep running while on STS UI.\r\n                     */\r\n                    href = popupWindow.location.href;\r\n                }\r\n                catch (e) { }\r\n                // Don't process blank pages or cross domain\r\n                if (StringUtils.isEmpty(href) || href === \"about:blank\") {\r\n                    return;\r\n                }\r\n                _this.logger.verbose(\"PopupHandler.waitForLogoutPopup - popup window is on same origin as caller, closing.\");\r\n                clearInterval(intervalId);\r\n                _this.cleanPopup(popupWindow);\r\n                resolve();\r\n            }, _this.config.system.pollIntervalMilliseconds);\r\n        });\r\n    };\r\n    /**\r\n     * @hidden\r\n     *\r\n     * Configures popup window for login.\r\n     *\r\n     * @param urlNavigate\r\n     * @param title\r\n     * @param popUpWidth\r\n     * @param popUpHeight\r\n     * @param popupWindowAttributes\r\n     * @ignore\r\n     * @hidden\r\n     */\r\n    PopupClient.prototype.openPopup = function (urlNavigate, popupParams) {\r\n        try {\r\n            var popupWindow = void 0;\r\n            // Popup window passed in, setting url to navigate to\r\n            if (popupParams.popup) {\r\n                popupWindow = popupParams.popup;\r\n                this.logger.verbosePii(\"Navigating popup window to: \" + urlNavigate);\r\n                popupWindow.location.assign(urlNavigate);\r\n            }\r\n            else if (typeof popupParams.popup === \"undefined\") {\r\n                // Popup will be undefined if it was not passed in\r\n                this.logger.verbosePii(\"Opening popup window to: \" + urlNavigate);\r\n                popupWindow = this.openSizedPopup(urlNavigate, popupParams.popupName, popupParams.popupWindowAttributes);\r\n            }\r\n            // Popup will be null if popups are blocked\r\n            if (!popupWindow) {\r\n                throw BrowserAuthError.createEmptyWindowCreatedError();\r\n            }\r\n            if (popupWindow.focus) {\r\n                popupWindow.focus();\r\n            }\r\n            this.currentWindow = popupWindow;\r\n            window.addEventListener(\"beforeunload\", this.unloadWindow);\r\n            return popupWindow;\r\n        }\r\n        catch (e) {\r\n            this.logger.error(\"error opening popup \" + e.message);\r\n            this.browserStorage.setInteractionInProgress(false);\r\n            throw BrowserAuthError.createPopupWindowError(e.toString());\r\n        }\r\n    };\r\n    /**\r\n     * Helper function to set popup window dimensions and position\r\n     * @param urlNavigate\r\n     * @param popupName\r\n     * @param popupWindowAttributes\r\n     * @returns\r\n     */\r\n    PopupClient.prototype.openSizedPopup = function (urlNavigate, popupName, popupWindowAttributes) {\r\n        var _a, _b, _c, _d;\r\n        /**\r\n         * adding winLeft and winTop to account for dual monitor\r\n         * using screenLeft and screenTop for IE8 and earlier\r\n         */\r\n        var winLeft = window.screenLeft ? window.screenLeft : window.screenX;\r\n        var winTop = window.screenTop ? window.screenTop : window.screenY;\r\n        /**\r\n         * window.innerWidth displays browser window\"s height and width excluding toolbars\r\n         * using document.documentElement.clientWidth for IE8 and earlier\r\n         */\r\n        var winWidth = window.innerWidth || document.documentElement.clientWidth || document.body.clientWidth;\r\n        var winHeight = window.innerHeight || document.documentElement.clientHeight || document.body.clientHeight;\r\n        var width = (_a = popupWindowAttributes.popupSize) === null || _a === void 0 ? void 0 : _a.width;\r\n        var height = (_b = popupWindowAttributes.popupSize) === null || _b === void 0 ? void 0 : _b.height;\r\n        var top = (_c = popupWindowAttributes.popupPosition) === null || _c === void 0 ? void 0 : _c.top;\r\n        var left = (_d = popupWindowAttributes.popupPosition) === null || _d === void 0 ? void 0 : _d.left;\r\n        if (!width || width < 0 || width > winWidth) {\r\n            this.logger.verbose(\"Default popup window width used. Window width not configured or invalid.\");\r\n            width = BrowserConstants.POPUP_WIDTH;\r\n        }\r\n        if (!height || height < 0 || height > winHeight) {\r\n            this.logger.verbose(\"Default popup window height used. Window height not configured or invalid.\");\r\n            height = BrowserConstants.POPUP_HEIGHT;\r\n        }\r\n        if (!top || top < 0 || top > winHeight) {\r\n            this.logger.verbose(\"Default popup window top position used. Window top not configured or invalid.\");\r\n            top = Math.max(0, ((winHeight / 2) - (BrowserConstants.POPUP_HEIGHT / 2)) + winTop);\r\n        }\r\n        if (!left || left < 0 || left > winWidth) {\r\n            this.logger.verbose(\"Default popup window left position used. Window left not configured or invalid.\");\r\n            left = Math.max(0, ((winWidth / 2) - (BrowserConstants.POPUP_WIDTH / 2)) + winLeft);\r\n        }\r\n        return window.open(urlNavigate, popupName, \"width=\" + width + \", height=\" + height + \", top=\" + top + \", left=\" + left + \", scrollbars=yes\");\r\n    };\r\n    /**\r\n     * Event callback to unload main window.\r\n     */\r\n    PopupClient.prototype.unloadWindow = function (e) {\r\n        this.browserStorage.cleanRequestByInteractionType(InteractionType.Popup);\r\n        if (this.currentWindow) {\r\n            this.currentWindow.close();\r\n        }\r\n        // Guarantees browser unload will happen, so no other errors will be thrown.\r\n        e.preventDefault();\r\n    };\r\n    /**\r\n     * Closes popup, removes any state vars created during popup calls.\r\n     * @param popupWindow\r\n     */\r\n    PopupClient.prototype.cleanPopup = function (popupWindow) {\r\n        if (popupWindow) {\r\n            // Close window.\r\n            popupWindow.close();\r\n        }\r\n        // Remove window unload function\r\n        window.removeEventListener(\"beforeunload\", this.unloadWindow);\r\n        // Interaction is completed - remove interaction status.\r\n        this.browserStorage.setInteractionInProgress(false);\r\n    };\r\n    /**\r\n     * Generates the name for the popup based on the client id and request\r\n     * @param clientId\r\n     * @param request\r\n     */\r\n    PopupClient.prototype.generatePopupName = function (scopes, authority) {\r\n        return BrowserConstants.POPUP_NAME_PREFIX + \".\" + this.config.auth.clientId + \".\" + scopes.join(\"-\") + \".\" + authority + \".\" + this.correlationId;\r\n    };\r\n    /**\r\n     * Generates the name for the popup based on the client id and request for logouts\r\n     * @param clientId\r\n     * @param request\r\n     */\r\n    PopupClient.prototype.generateLogoutPopupName = function (request) {\r\n        var homeAccountId = request.account && request.account.homeAccountId;\r\n        return BrowserConstants.POPUP_NAME_PREFIX + \".\" + this.config.auth.clientId + \".\" + homeAccountId + \".\" + this.correlationId;\r\n    };\r\n    return PopupClient;\r\n}(StandardInteractionClient));\n\nexport { PopupClient };\n"]},"metadata":{},"sourceType":"module"}